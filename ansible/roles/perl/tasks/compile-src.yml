#                  _    ___            _        
#  _ __   ___ _ __| |  / / |_ __ _ ___| | _____ 
# | '_ \ / _ \ '__| | / /| __/ _` / __| |/ / __|
# | |_) |  __/ |  | |/ / | || (_| \__ \   <\__ \
# | .__/ \___|_|  |_/_/   \__\__,_|___/_|\_\___/
# |_|                                           
# compile-src
#
- name: 'compile-src | REBUILD | make clean'
  shell: >
    make clean distclean
    chdir={{ local.src }}/perl-{{ perl.version }}/
    removes=Makefile
  when: perl.rebuild == True

- name: 'compile-src | Perl {{ perl.version }} should be configured'
  shell: >
    /bin/sh Configure -des -Dprefix={{ perl.install }}
    creates=Makefile
    chdir={{ local.src }}/perl-{{ perl.version }}/

- name: 'compile-src | make Perl {{ perl.version }}'
  command: >
    make
    chdir={{ local.src }}/perl-{{ perl.version }}/
    creates=perl
  register: make_perl_binary

- name: 'compile-src | make test'
  when: make_perl_binary.changed
  command: >
    make test
    chdir={{ local.src }}/perl-{{ perl.version }}/

- name: 'compile-src | make install perl {{ perl.version }}'
  when: make_perl_binary.changed
  command: >
    make install
    chdir={{ local.src }}/perl-{{ perl.version }}/

