#  _     _           _  ___    ___            _        
# | |__ (_)_ __   __| |/ _ \  / / |_ __ _ ___| | _____ 
# | '_ \| | '_ \ / _` | (_) |/ /| __/ _` / __| |/ / __|
# | |_) | | | | | (_| |\__, / / | || (_| \__ \   <\__ \
# |_.__/|_|_| |_|\__,_|  /_/_/   \__\__,_|___/_|\_\___/
#                                                      
# compile-src
- name: compile-src | REBUILD | make clean
  command: >
    make clean
    chdir={{ bind.workingdir }}/bind-{{ bind.version }}/
    removes=Makefile
  when: bind.rebuild == True

- name: compile-src | bind {{ bind.version }} should be configured
  notify: Restart bind
  shell: >
    /bin/sh configure
    --prefix={{ bind.serverroot }}
    --with-openssl=/usr/local
    --enable-largefile
    --disable-ipv6
    creates=Makefile
    chdir={{ bind.workingdir }}/bind-{{ bind.version }}/

- name: compile-src | make bind {{ bind.version }}
  notify: Restart bind
  command: >
    make
    chdir={{ bind.workingdir }}/bind-{{ bind.version }}/
    creates=bin/named/named
  register: make_bind_binary

- name: compile-src | bind {{ bind.version }} should be installed
  when: make_bind_binary.changed
  notify: Restart bind
  command: >
    make install
    chdir={{ bind.workingdir }}/bind-{{ bind.version }}/

